# CI/CDæ•…éšœæ’é™¤æŒ‡å—

åŸºäºæœ€è¿‘çš„æœ¬åœ°CIæµ‹è¯•ç»éªŒï¼Œä»¥ä¸‹æ˜¯å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚

## ç¯å¢ƒè®¾ç½®é—®é¢˜

### Node.jsç‰ˆæœ¬é—®é¢˜
**é—®é¢˜**: TypeScriptç¼–è¯‘å¤±è´¥ï¼Œç‰ˆæœ¬ä¸å…¼å®¹
```bash
error TS5023: Unknown compiler option 'useUnknownInCatchVariables'
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # åº”è¯¥æ˜¯24.x

# å‡çº§Node.js (å¦‚æœéœ€è¦)
brew install node@24

# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules yarn.lock
yarn install --frozen-lockfile
```

### Foundryå®‰è£…é—®é¢˜
**é—®é¢˜**: Apple Siliconå…¼å®¹æ€§é—®é¢˜
```bash
Error: "Bad CPU type in executable (os error 86)"
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£…libusb
brew install libusb

# é‡æ–°å®‰è£…Foundry
foundryup

# éªŒè¯å®‰è£…
forge --version
```

## ç¼–è¯‘é—®é¢˜

### Solidityç¼–è¯‘å™¨ç‰ˆæœ¬ä¸å…¼å®¹
**é—®é¢˜**: æ—§ç‰ˆæœ¬ç¼–è¯‘å™¨åœ¨Apple Siliconä¸Šå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥foundry.tomlé…ç½®
2. ä½¿ç”¨Dockerè¿›è¡Œç¼–è¯‘ï¼š
```bash
# ä½¿ç”¨Dockerè¿è¡Œç¼–è¯‘
docker run --rm -v $(pwd):/workspace \
  ghcr.io/foundry-rs/foundry:latest \
  forge build --root /workspace
```

3. æˆ–è€…å‡çº§åˆçº¦åˆ°æ–°ç‰ˆæœ¬Solidity

### TypeScriptç±»å‹é”™è¯¯
**é—®é¢˜**: ç¼ºå°‘ç±»å‹å®šä¹‰
```bash
error TS2688: Cannot find type definition file for 'minimatch'
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£…ç¼ºå¤±çš„ç±»å‹å®šä¹‰
cd packages/contract-addresses
yarn add --dev @types/minimatch

# æˆ–è€…åœ¨æ ¹ç›®å½•æ·»åŠ åˆ°workspace
yarn add -W --dev @types/minimatch
```

## æµ‹è¯•é—®é¢˜

### Foundryæµ‹è¯•å¤±è´¥
**å¸¸è§åŸå› **:
1. ç¼ºå°‘Gitå­æ¨¡å—
2. ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸åŒ¹é…
3. ä¾èµ–ç¼ºå¤±

**è§£å†³æ­¥éª¤**:
```bash
# 1. åˆå§‹åŒ–æ‰€æœ‰å­æ¨¡å—
git submodule update --init --recursive

# 2. æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
forge clean
forge build

# 3. è¿è¡Œç‰¹å®šæµ‹è¯•
forge test --match-contract MyContractTest -vvv

# 4. æ£€æŸ¥gasæŠ¥å‘Š
forge test --gas-report
```

### TypeScriptæµ‹è¯•å¤±è´¥
**å¸¸è§é—®é¢˜**:
1. å¼‚æ­¥æ“ä½œæœªæ­£ç¡®å¤„ç†
2. Mockè®¾ç½®ä¸æ­£ç¡®
3. ç¯å¢ƒå˜é‡ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æµ‹è¯•é…ç½®
cat jest.config.js

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
yarn test --testNamePattern="OrderUtils"

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
yarn test --verbose --detectOpenHandles
```

## æ€§èƒ½ä¼˜åŒ–

### ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–
```bash
# å¹¶è¡Œç¼–è¯‘
export FOUNDRY_PROFILE=ci
forge build --jobs 4

# å¢é‡ç¼–è¯‘
forge build --force  # ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨
```

### æµ‹è¯•é€Ÿåº¦ä¼˜åŒ–
```bash
# å¹¶è¡Œæµ‹è¯•
forge test --jobs 4

# ä»…è¿è¡Œå¿«é€Ÿæµ‹è¯•
forge test --no-match-path "**/integration/**"
```

## CIè„šæœ¬ç¤ºä¾‹

### å®Œæ•´çš„CIå·¥ä½œæµ
```bash
#!/bin/bash
set -e

echo "ğŸ”§ è®¾ç½®ç¯å¢ƒ..."
node --version
yarn --version
forge --version

echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
yarn install --frozen-lockfile

echo "ğŸ—ï¸ æ„å»ºé¡¹ç›®..."
yarn build

echo "ğŸ§¹ ä»£ç è´¨é‡æ£€æŸ¥..."
yarn lint:contracts
yarn prettier:ci

echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
# Governanceæµ‹è¯•ï¼ˆç¨³å®šï¼‰
cd contracts/governance
forge test -vvv --gas-report

# å…¶ä»–æµ‹è¯•ï¼ˆå¦‚æœæ”¯æŒï¼‰
cd ../erc20
if forge build; then
    forge test -vvv
else
    echo "âš ï¸ ERC20æµ‹è¯•è·³è¿‡ï¼ˆç¼–è¯‘å™¨å…¼å®¹æ€§é—®é¢˜ï¼‰"
fi

echo "âœ… CIæ£€æŸ¥å®Œæˆï¼"
```

### æ•…éšœæ’é™¤è„šæœ¬
```bash
#!/bin/bash
# troubleshoot-ci.sh

echo "ğŸ” è¯Šæ–­CIé—®é¢˜..."

echo "æ£€æŸ¥Node.jsç¯å¢ƒ..."
node --version
npm --version
yarn --version

echo "æ£€æŸ¥Foundryç¯å¢ƒ..."
foundryup --version || echo "Foundryæœªå®‰è£…"
forge --version || echo "Forgeä¸å¯ç”¨"

echo "æ£€æŸ¥Gitå­æ¨¡å—..."
git submodule status

echo "æ£€æŸ¥ä¾èµ–..."
yarn check --integrity

echo "æ£€æŸ¥TypeScripté…ç½®..."
npx tsc --noEmit --skipLibCheck

echo "è¯Šæ–­å®Œæˆï¼"
```

## å¸¸ç”¨è°ƒè¯•å‘½ä»¤

```bash
# è¯¦ç»†çš„ç¼–è¯‘è¾“å‡º
forge build --verbose

# è¯¦ç»†çš„æµ‹è¯•è¾“å‡º
forge test -vvvv

# æ£€æŸ¥åˆçº¦å¤§å°
forge build --sizes

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
forge coverage --report summary

# æ£€æŸ¥ä¾èµ–å†²çª
yarn check --verify-tree

# æ¸…ç†æ‰€æœ‰ç¼“å­˜
yarn cache clean
forge clean
rm -rf node_modules
```
---
description: CI/CD troubleshooting guide and common issues
---

# Solidity ç‰ˆæœ¬å‡çº§å’Œä»£ç æ¸…ç†æŒ‡å—

## å‡çº§çŠ¶æ€
âœ… **ç›®æ ‡ç‰ˆæœ¬**: Solidity 0.8.28 (ä»0.8.19å‡çº§)
âœ… **EVMç‰ˆæœ¬**: cancun (ä»shanghaiå‡çº§)  
âœ… **ç¼–è¯‘å™¨**: Foundry 1.2.3+ (ç»Ÿä¸€ä½¿ç”¨)

## ç‰ˆæœ¬æ¸…ç†å·¥ä½œ

### âœ… å·²å®Œæˆçš„æ¨¡å—æ¸…ç†

#### Utilsæ¨¡å— ([contracts/utils/](mdc:contracts/utils/))
- âœ… **åˆ é™¤æ—§ç‰ˆæœ¬**: ç§»é™¤v06ç›®å½•å’Œæ ¹ç›®å½•æ—§æ–‡ä»¶
- âœ… **ç»Ÿä¸€å‘½å**: LibBytesV08 â†’ LibBytes
- âœ… **æ›´æ–°å¯¼å…¥**: æ‰€æœ‰V08åç¼€å·²æ¸…ç†
- âœ… **é…ç½®æ›´æ–°**: foundry.tomlæŒ‡å‘ç»Ÿä¸€è·¯å¾„

#### ERC20æ¨¡å— ([contracts/erc20/](mdc:contracts/erc20/))  
- âœ… **åˆ é™¤æ—§ç‰ˆæœ¬**: ç§»é™¤v06ç›®å½•
- âœ… **ç»Ÿä¸€ç»“æ„**: v08æ–‡ä»¶ç§»è‡³æ ¹ç›®å½•
- âœ… **é‡å‘½åæ¸…ç†**: LibERC20TokenV08 â†’ LibERC20Token
- âœ… **è·¯å¾„ä¿®æ­£**: æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„

### ğŸ“‹ æ ‡å‡†å‡çº§æ¸…å•

å‡çº§ä»»ä½•æ¨¡å—æ—¶å¿…é¡»æ£€æŸ¥ï¼š
- [ ] æ›´æ–° pragma ç‰ˆæœ¬åˆ° 0.8.28
- [ ] ç§»é™¤ SafeMath åº“è°ƒç”¨
- [ ] ç§»é™¤ `pragma experimental ABIEncoderV2`
- [ ] ä¿®å¤æ„é€ å‡½æ•°è¯­æ³• (`public` â†’ ç§»é™¤)
- [ ] æ£€æŸ¥ `chainid()` å‡½æ•°å¯è§æ€§ (`pure` â†’ `view`)
- [ ] æ›´æ–° foundry.toml é…ç½®

### ğŸ—ï¸ ç›®å½•ç»“æ„æ ‡å‡†

#### æ¨èç»“æ„
```
contracts/module/
â”œâ”€â”€ foundry.toml           # Foundryé…ç½®
â”œâ”€â”€ src/                   # ç»Ÿä¸€çš„Solidityæºç ç›®å½•
â”‚   â”œâ”€â”€ LibExample.sol     # æ— ç‰ˆæœ¬åç¼€
â”‚   â”œâ”€â”€ interfaces/        # æ¥å£æ–‡ä»¶
â”‚   â””â”€â”€ errors/           # é”™è¯¯å®šä¹‰
â”œâ”€â”€ test/                  # æµ‹è¯•ç›®å½•
â””â”€â”€ lib/                  # ä¾èµ–åº“
```

#### âŒ é¿å…çš„ç»“æ„
```
contracts/module/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ v06/              # æ—§ç‰ˆæœ¬ç›®å½•
â”‚   â”œâ”€â”€ v08/              # ç‰ˆæœ¬åŒ–ç›®å½•
â”‚   â””â”€â”€ LibExampleV08.sol # ç‰ˆæœ¬åŒ–æ–‡ä»¶å
```

## é…ç½®æ ‡å‡†

### Foundryé…ç½® ([foundry.toml](mdc:foundry.toml))
```toml
[profile.default]
src = 'contracts/src'      # ç»Ÿä¸€æºç è·¯å¾„
out = 'out'
libs = ['lib']
solc_version = "0.8.28"    # ç»Ÿä¸€ç‰ˆæœ¬
optimizer = true
optimizer_runs = 1000000   # é«˜ä¼˜åŒ–
evm_version = "cancun"     # æœ€æ–°EVM
```

### å†…å­˜å¼•ç”¨ [[memory:3840863]]
é¡¹ç›®å·²å†³å®šå°† Solidity ç‰ˆæœ¬æ ‡å‡†ä» 0.8.19 å‡çº§åˆ° 0.8.28ã€‚æ‰€æœ‰æ–°åˆçº¦å’Œç°æœ‰åˆçº¦å‡çº§éƒ½åº”ä½¿ç”¨ pragma solidity 0.8.28ã€‚

## ä»£ç ç°ä»£åŒ–

### SafeMathç§»é™¤ç¤ºä¾‹
```solidity
// âŒ æ—§ç‰ˆæœ¬ (0.6.x)
using SafeMath for uint256;
votingPower = delegatedBalance.safeAdd(balanceDelegatedToDefaultPool).safeDiv(2);

// âœ… æ–°ç‰ˆæœ¬ (0.8.28)
votingPower = (delegatedBalance + balanceDelegatedToDefaultPool) / 2;
```

### æ„é€ å‡½æ•°ç°ä»£åŒ–
```solidity
// âŒ æ—§ç‰ˆæœ¬
constructor(...) public { }

// âœ… æ–°ç‰ˆæœ¬  
constructor(...) { }
```

### ç¼–ç å™¨å£°æ˜æ¸…ç†
```solidity
// âŒ ç§»é™¤è¿™ä¸€è¡Œ
// pragma experimental ABIEncoderV2;
```

## å…¼å®¹æ€§æŒ‡å—

### Apple Siliconæ”¯æŒ [[memory:solidity-apple-silicon]]
- **é—®é¢˜**: `Bad CPU type in executable (os error 86)`
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨0.8.0+ç‰ˆæœ¬
- **ç­–ç•¥**: ä¼˜å…ˆå‡çº§ï¼Œå¿…è¦æ—¶åˆ†ç¦»åˆ°legacy_contracts/

### ä¾èµ–ç®¡ç†
- **å·¥å…·åº“**: contracts/utils ä¸ºå…¶ä»–æ¨¡å—æä¾›åŸºç¡€
- **å¯¼å…¥è·¯å¾„**: ä½¿ç”¨ç»Ÿä¸€çš„ç›¸å¯¹è·¯å¾„
- **ç‰ˆæœ¬åç¼€**: æ–°ä»£ç ç¦æ­¢ä½¿ç”¨ç‰ˆæœ¬åç¼€

## è¿ç§»æ£€æŸ¥æ¸…å•

### ä»£ç æ£€æŸ¥
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰é—ç•™çš„ç‰ˆæœ¬åç¼€
find . -name "*V08*" -o -name "*v06*" -o -name "*v08*"

# æ£€æŸ¥SafeMathä½¿ç”¨
grep -r "SafeMath" contracts/

# æ£€æŸ¥å®éªŒæ€§ç¼–ç å™¨
grep -r "experimental ABIEncoderV2" contracts/
```

### ç¼–è¯‘éªŒè¯
```bash
# åœ¨æ¨¡å—ç›®å½•ä¸‹
forge build --sizes  # æ£€æŸ¥ç¼–è¯‘å’Œåˆçº¦å¤§å°
forge test           # éªŒè¯æµ‹è¯•é€šè¿‡
```

## å‚è€ƒå®ç°

å®Œæ•´å‡çº§å‚è€ƒ: [contracts/treasury/contracts/src/ZrxTreasury.sol](mdc:contracts/treasury/contracts/src/ZrxTreasury.sol)

æœ€ä½³å®è·µæ¨¡å—: [contracts/utils/](mdc:contracts/utils/)
description:
globs:
alwaysApply: false
---

yarn run v1.22.22
$ run-s test:hardhat test:forge
$ npx hardhat test
npm warn Unknown env config "version-git-tag". This will stop working in the next major version of npm.
npm warn Unknown env config "network-timeout". This will stop working in the next major version of npm.
npm warn Unknown env config "argv". This will stop working in the next major version of npm.
npm warn Unknown env config "version-commit-hooks". This will stop working in the next major version of npm.
npm warn Unknown env config "version-git-message". This will stop working in the next major version of npm.
npm warn Unknown env config "version-tag-prefix". This will stop working in the next major version of npm.


âœ… Test environment setup with modern chai matchers
  Asset Proxy Contracts - Modern ethers v6 Tests
ðŸš€ Blockchain lifecycle started
âœ… Modern test environment initialized
    ERC20Proxy
ðŸŽ¯ ERC20Proxy deployed at: 0x1dC4c1cEFEF38a777b15aA20260a54E584b16C48
      âœ” should deploy and have correct proxy ID
    MultiAssetProxy
ðŸŽ¯ MultiAssetProxy deployed at: 0x1D7022f5B17d2F8B695918FB48fa1089C9f85401
      âœ” should deploy and handle multiple asset types
    StaticCallProxy
ðŸŽ¯ StaticCallProxy deployed at: 0x871DD7C2B4b25E1Aa18728e9D5f2Af4C4e431f5c
      âœ” should deploy and be ready for static calls
    Modern Testing Patterns
ðŸŽ¯ Owner: 0x5409ED021D9299bf6814279A6A1411A7e866A631
ðŸŽ¯ User: 0x6Ecbe1DB9EF729CBe972C83Fb886247691Fb6beb
      âœ” should demonstrate ethers v6 best practices
      âœ” should demonstrate modern revert assertions
âª Blockchain state reverted

  Authorizable
    addAuthorizedAddress
      - should revert if not called by owner
      - should allow owner to add an authorized address
      - should revert if owner attempts to authorize a duplicate address
    removeAuthorizedAddress
      - should revert if not called by owner
      - should allow owner to remove an authorized address
      - should revert if owner attempts to remove an address that is not authorized
    removeAuthorizedAddressAtIndex
      - should revert if not called by owner
      - should revert if index is >= authorities.length
      - should revert if owner attempts to remove an address that is not authorized
      - should revert if address at index does not match target
      - should allow owner to remove an authorized address
    getAuthorizedAddresses
      - should return all authorized addresses

  Bancor unit tests
    isValidSignature()
      âœ” returns success bytes
    bridgeTransferFrom()
      âœ” returns magic bytes on success
      token -> token
        1) calls BancorNetwork.convertByPath()
        2) sets allowance for "from" token
        âœ” fails if the router fails
      token -> token -> token
        3) calls BancorNetwork.convertByPath()

  ChaiBridge unit tests
â­ï¸ Skipping ChaiBridge tests - needs modern factory and contract compilation
    bridgeTransferFrom()
      - fails if not called by ERC20BridgeProxy
      - returns magic bytes upon success
      - should increase the Dai balance of `toAddress` by `amount` if successful
      - fails if the `chai.draw` call fails

  DydxBridge unit tests
    bridgeTransferFrom()
      âœ” succeeds when calling with zero amount
      âœ” succeeds when calling with no accounts
      âœ” succeeds when calling with no actions
      âœ” succeeds when calling `operate` with the `deposit` action and a single account
      âœ” succeeds when calling `operate` with the `deposit` action and multiple accounts
      âœ” succeeds when calling `operate` with the `withdraw` action and a single account
      âœ” succeeds when calling `operate` with the `withdraw` action and multiple accounts
      âœ” succeeds when calling `operate` with the `deposit` action and multiple accounts
      âœ” succeeds when calling `operate` with multiple actions under a single account
      âœ” succeeds when scaling the `amount` to deposit
      âœ” succeeds when scaling the `amount` to withdraw
      4) reverts if not called by the ERC20 Bridge Proxy
      âœ” should return magic bytes if call succeeds
      âœ” should revert when `Operate` reverts
      âœ” should revert when there is a rounding error
    ERC20BridgeProxy.transferFrom()
      - should succeed if `bridgeTransferFrom` succeeds
      - should revert if `bridgeTransferFrom` reverts

  ERC1155Proxy
âœ… Deployed ERC1155Receiver at: 0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435
    general
      âœ” should revert if undefined function is called
      âœ” should have an id of 0xa7cb5fb7
    transferFrom
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1500, actual=1500
      âœ” should successfully transfer value for a single, fungible token
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=820, actual=820
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1180, actual=1180
      âœ” should successfully transfer value for the same fungible token several times
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=680564733841876926926749214863536422912, expected=1000, actual=1000
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=1020847100762815390390123822295304634368, expected=1000, actual=1000
Balance 3: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 4: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=680564733841876926926749214863536422912, expected=1000, actual=1000
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=1020847100762815390390123822295304634368, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=960, actual=960
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=680564733841876926926749214863536422912, expected=940, actual=940
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=1020847100762815390390123822295304634368, expected=920, actual=920
Balance 3: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1040, actual=1040
Balance 4: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=680564733841876926926749214863536422912, expected=1060, actual=1060
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=1020847100762815390390123822295304634368, expected=1080, actual=1080
      âœ” should successfully transfer value for several fungible tokens
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
      âœ” should successfully transfer a non-fungible token
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=1, actual=1
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=1, actual=1
Balance 3: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 4: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=0, actual=0
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=0, actual=0
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=0, actual=0
Balance 3: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 4: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=1, actual=1
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=1, actual=1
      âœ” should successfully transfer multiple non-fungible tokens
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=680564733841876926926749214863536422912, expected=1000, actual=1000
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=1020847100762815390390123822295304634368, expected=1000, actual=1000
Balance 3: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 4: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=1, actual=1
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 6: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=680564733841876926926749214863536422912, expected=1000, actual=1000
Balance 7: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=1020847100762815390390123822295304634368, expected=1000, actual=1000
Balance 8: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 9: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=750, actual=750
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=680564733841876926926749214863536422912, expected=990, actual=990
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=1020847100762815390390123822295304634368, expected=990, actual=990
Balance 3: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 4: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=0, actual=0
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1250, actual=1250
Balance 6: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=680564733841876926926749214863536422912, expected=1010, actual=1010
Balance 7: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=1020847100762815390390123822295304634368, expected=1010, actual=1010
Balance 8: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 9: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=1, actual=1
      âœ” should successfully transfer value for a combination of several fungible/non-fungible tokens
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value to a smart contract and trigger its callback
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value to a smart contract and trigger its callback, when callback `data` is NULL
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value to a smart contract and trigger its callback, when callback `data` is one word
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value to a smart contract and trigger its callback, when callback `data` is multiple words
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value to a smart contract and trigger its callback, when callback `data` is multiple words but not word-aligned
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=500, actual=500
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=500, actual=500
      âœ” should successfully transfer value and ignore extra assetData
      âœ” should successfully transfer if token ids and values are abi encoded to same entry in calldata
      âœ” should successfully transfer if token values and data are abi encoded to same entry in calldata
      âœ” should successfully transfer if token ids, values and data are abi encoded to same entry in calldata
      âœ” should revert if token ids resolves to outside the bounds of calldata
      âœ” should revert if an element of token ids lies to outside the bounds of calldata
      âœ” should revert token ids length overflows
      âœ” should revert token values length overflows
      âœ” should revert token data length overflows
      âœ” should revert if token values resolves to outside the bounds of calldata
      âœ” should revert if an element of token values lies to outside the bounds of calldata
      âœ” should revert if token data resolves to outside the bounds of calldata
      âœ” should revert if an element of token data lies to outside the bounds of calldata
      âœ” should revert if asset data lies outside the bounds of calldata
      âœ” should revert if asset data lies outside the bounds of calldata
      âœ” should revert if length of assetData is less than 132 bytes
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should transfer nothing if value is zero
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should transfer nothing if value multiplier is zero
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should transfer nothing if there are no tokens in asset data
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x4112f5fc3f737e813ca8cC1A48D1da3dc8719435, token=340282366920938463463374607431768211456, expected=0, actual=0
      âœ” should propagate revert reason from erc1155 contract failure
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 2: owner=undefined, token=undefined, expected=0, actual=0
Balance 3: owner=undefined, token=undefined, expected=0, actual=0
      âœ” should revert if transferring the same non-fungible token more than once
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=1, actual=1
Balance 2: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=1, actual=1
Balance 3: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
Balance 4: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930718380735871543581289287293137783357444, expected=0, actual=0
Balance 5: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953931058663102792482044752661900569551568900, expected=0, actual=0
      âœ” should revert if there is a multiplication overflow
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
      âœ” should revert if transferring > 1 instances of a non-fungible token (valueMultiplier field >1)
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=1, actual=1
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=57896044618658097711785492504343953930378098368950605117825912685706015145988, expected=0, actual=0
      âœ” should revert if transferring > 1 instances of a non-fungible token (`valuesToTransfer` field >1)
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should revert if sender balance is insufficient
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should revert if sender allowance is insufficient
Balance 0: owner=0xE834EC434DABA538cd1b9Fe1582052B880BD7e63, token=340282366920938463463374607431768211456, expected=1000, actual=1000
Balance 1: owner=0x78dc5D2D739606d31509C31d654056A45185ECb6, token=340282366920938463463374607431768211456, expected=1000, actual=1000
      âœ” should revert if caller is not authorized

  ERC20BridgeProxy unit tests
    transferFrom()
      5) succeeds if the bridge succeeds and balance increases by `amount`
      6) succeeds if balance increases more than `amount`
      7) passes the correct arguments to the bridge contract
      âœ” fails if not called by an authorized address
      âœ” fails if asset data is truncated
      âœ” fails if bridge returns nothing
      âœ” fails if bridge returns true
      8) fails if bridge returns 0x1
      âœ” fails if bridge is an EOA
      9) fails if bridge reverts
      10) fails if balance of `to` increases by less than `amount`
      11) fails if balance of `to` decreases
    balanceOf()
      12) retrieves the balance of the encoded token
    getProxyId()
      âœ” returns the correct proxy ID

  Eth2DaiBridge unit tests
    isValidSignature()
      âœ” returns success bytes
    bridgeTransferFrom()
      âœ” returns magic bytes on success
      13) calls `Eth2Dai.sellAllAmount()`
      14) sets an unlimited allowance on the `fromTokenAddress` token
      15) transfers filled amount to `to`
      âœ” fails if `Eth2Dai.sellAllAmount()` reverts
      âœ” fails if `toTokenAddress.transfer()` reverts
      16) fails if `toTokenAddress.transfer()` returns false
      âœ” succeeds if `toTokenAddress.transfer()` returns true

  KyberBridge unit tests
    isValidSignature()
      âœ” returns success bytes
    bridgeTransferFrom()
      17) "before all" hook for "returns magic bytes on success"

  Asset Transfer Proxies
    ERC20Proxy
      âœ” should revert if undefined function is called
      âœ” should have an id of 0xf47261b0
      transferFrom
        âœ” should successfully transfer tokens
        âœ” should successfully transfer tokens that do not return a value
        âœ” should successfully transfer tokens and ignore extra assetData
        âœ” should do nothing if transferring 0 amount of a token
        âœ” should revert if allowances are too low
        âœ” should revert if allowances are too low and token does not return a value
        âœ” should revert if caller is not authorized
        âœ” should revert if token returns more than 32 bytes
    ERC721Proxy
      âœ” should revert if undefined function is called
      âœ” should have an id of 0x02571792
      transferFrom
        âœ” should successfully transfer tokens
        âœ” should successfully transfer tokens and ignore extra assetData
        âœ” should not call onERC721Received when transferring to a smart contract
        âœ” should revert if transferring 0 amount of a token
        âœ” should revert if transferring > 1 amount of a token
        âœ” should revert if allowances are too low
        âœ” should revert if caller is not authorized
    MultiAssetProxy
      âœ” should revert if undefined function is called
      âœ” should have an id of 0x94cfcdd7
      transferFrom
        âœ” should transfer a single ERC20 token
        âœ” should dispatch an ERC20 transfer when input amount is 0
        âœ” should successfully transfer multiple of the same ERC20 token
        âœ” should successfully transfer multiple different ERC20 tokens
        âœ” should transfer a single ERC721 token
        âœ” should successfully transfer multiple of the same ERC721 token
        âœ” should successfully transfer multiple different ERC721 tokens
        âœ” should transfer a fungible ERC1155 token
        âœ” should revert with ERC1155_INSUFFICIENT_BALANCE when balance is insufficient
        - should successfully transfer multiple fungible tokens of the same ERC1155 contract
        - should successfully transfer multiple fungible/non-fungible tokens of the same ERC1155 contract
        - should successfully transfer multiple different ERC1155 tokens
        - should successfully transfer a combination of ERC20, ERC721, and ERC1155 tokens
        âœ” should successfully transfer a combination of ERC20 and ERC721 tokens
        - should successfully transfer tokens and ignore extra assetData
        âœ” should successfully transfer correct amounts when the `amount` > 1
        âœ” should successfully transfer a large amount of tokens
        âœ” should revert if a single transfer fails
        âœ” should revert if an AssetProxy is not registered
        âœ” should revert if the length of `amounts` does not match the length of `nestedAssetData`
        âœ” should revert if amounts multiplication results in an overflow
        âœ” should revert if an element of `nestedAssetData` is < 4 bytes long
        âœ” should revert if caller is not authorized
        âœ” should revert if asset data overflows beyond the bounds of calldata
        âœ” should revert if asset data resolves to a location beyond the bounds of calldata
        âœ” should revert if length of assetData, excluding the selector, is not a multiple of 32
        âœ” should revert if length of assetData is less than 68 bytes

  StaticCallProxy
    general
      âœ” should revert if undefined function is called
      âœ” should have an id of 0xc339d10a
    transferFrom
      âœ” should revert if assetData lies outside the bounds of calldata
      âœ” should revert if the length of assetData is less than 100 bytes
      âœ” should revert if the offset to `staticCallData` points to outside of assetData
      âœ” should revert if the callTarget attempts to write to state
      âœ” should revert with data provided by the callTarget if the staticcall reverts
      âœ” should revert if the hash of the output is different than expected expected
      âœ” should be successful if a function call with no inputs and no outputs is successful
      âœ” should be successful if the staticCallTarget is not a contract and no return value is expected
      âœ” should be successful if a function call with one static input returns the correct value
      âœ” should be successful if a function with one dynamic input is successful
      18) should be successful if a function call returns a complex type

  UniswapBridge unit tests
    isValidSignature()
      âœ” returns success bytes
    bridgeTransferFrom()
      âœ” returns magic bytes on success
      19) just transfers tokens to `to` if the same tokens are in play
      token -> token
        20) calls `IUniswapExchange.tokenToTokenTransferInput()
        21) sets allowance for "from" token
        22) sets allowance for "from" token on subsequent calls
        âœ” fails if "from" token does not exist
        âœ” fails if the exchange fails
      token -> ETH
        23) calls `IUniswapExchange.tokenToEthSwapInput()`, `WETH.deposit()`, then `transfer()`
        24) sets allowance for "from" token
        25) sets allowance for "from" token on subsequent calls
        âœ” fails if "from" token does not exist
        âœ” fails if `WETH.deposit()` fails
        âœ” fails if the exchange fails
      ETH -> token
        26) calls  `WETH.withdraw()`, then `IUniswapExchange.ethToTokenTransferInput()`
        27) does not set any allowance
        âœ” fails if "to" token does not exist
        âœ” fails if the `WETH.withdraw()` fails
        28) fails if the exchange fails

  UniswapV2 unit tests
    isValidSignature()
      âœ” returns success bytes
    bridgeTransferFrom()
      âœ” returns magic bytes on success
      29) performs transfer when both tokens are the same
      token -> token
        30) calls UniswapV2Router01.swapExactTokensForTokens()
        31) sets allowance for "from" token
        32) sets allowance for "from" token on subsequent calls
        âœ” fails if the router fails
      token -> token -> token
        33) calls UniswapV2Router01.swapExactTokensForTokens()

ðŸ§¹ Test environment cleanup

  141 passing (1s)
  23 pending
  33 failing

  1) Bancor unit tests
       bridgeTransferFrom()
         token -> token
           calls BancorNetwork.convertByPath():

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/bancor_bridge.ts:164:45)

  2) Bancor unit tests
       bridgeTransferFrom()
         token -> token
           sets allowance for "from" token:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/bancor_bridge.ts:180:45)

  3) Bancor unit tests
       bridgeTransferFrom()
         token -> token -> token
           calls BancorNetwork.convertByPath():

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/bancor_bridge.ts:201:45)

  4) DydxBridge unit tests
       bridgeTransferFrom()
         reverts if not called by the ERC20 Bridge Proxy:
     AssertionError: Expected transaction to be reverted with reason 'DydxBridge/ONLY_CALLABLE_BY_ERC20_BRIDGE_PROXY', but it didn't revert
  

  5) ERC20BridgeProxy unit tests
       transferFrom()
         succeeds if the bridge succeeds and balance increases by `amount`:
     Error: Transaction reverted and Hardhat couldn't infer the reason.
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.transferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async transferFromAsync (test/erc20bridge_proxy.ts:144:24)
    at async Context.<anonymous> (test/erc20bridge_proxy.ts:161:13)
  

  6) ERC20BridgeProxy unit tests
       transferFrom()
         succeeds if balance increases more than `amount`:
     Error: Transaction reverted and Hardhat couldn't infer the reason.
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.transferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async transferFromAsync (test/erc20bridge_proxy.ts:144:24)
    at async Context.<anonymous> (test/erc20bridge_proxy.ts:174:13)
  

  7) ERC20BridgeProxy unit tests
       transferFrom()
         passes the correct arguments to the bridge contract:
     Error: Transaction reverted and Hardhat couldn't infer the reason.
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at ERC20BridgeProxy.transferFrom (contracts/src/ERC20BridgeProxy.sol:65)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.transferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async transferFromAsync (test/erc20bridge_proxy.ts:144:24)
    at async Context.<anonymous> (test/erc20bridge_proxy.ts:179:26)
  

  8) ERC20BridgeProxy unit tests
       transferFrom()
         fails if bridge returns 0x1:
     AssertionError: Expected transaction to be reverted with reason 'BRIDGE_FAILED', but it reverted without a reason
  

  9) ERC20BridgeProxy unit tests
       transferFrom()
         fails if bridge reverts:
     AssertionError: Expected transaction to be reverted with reason 'FOOBAR', but it reverted without a reason
  

  10) ERC20BridgeProxy unit tests
       transferFrom()
         fails if balance of `to` increases by less than `amount`:
     AssertionError: Expected transaction to be reverted with reason 'BRIDGE_UNDERPAY', but it reverted without a reason
  

  11) ERC20BridgeProxy unit tests
       transferFrom()
         fails if balance of `to` decreases:
     AssertionError: Expected transaction to be reverted with reason 'BRIDGE_UNDERPAY', but it reverted without a reason
  

  12) ERC20BridgeProxy unit tests
       balanceOf()
         retrieves the balance of the encoded token:
     Error: Transaction reverted and Hardhat couldn't infer the reason.
    at ERC20BridgeProxy.balanceOf (contracts/src/ERC20BridgeProxy.sol:109)
    at ERC20BridgeProxy.balanceOf (contracts/src/ERC20BridgeProxy.sol:109)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async staticCallResult (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:337:22)
    at async staticCall (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:303:24)
    at async Proxy.balanceOf (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:351:41)
    at async Context.<anonymous> (test/erc20bridge_proxy.ts:300:35)
  

  13) Eth2DaiBridge unit tests
       bridgeTransferFrom()
         calls `Eth2Dai.sellAllAmount()`:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/eth2dai_bridge.ts:169:41)

  14) Eth2DaiBridge unit tests
       bridgeTransferFrom()
         sets an unlimited allowance on the `fromTokenAddress` token:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/eth2dai_bridge.ts:182:41)

  15) Eth2DaiBridge unit tests
       bridgeTransferFrom()
         transfers filled amount to `to`:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/eth2dai_bridge.ts:194:41)

  16) Eth2DaiBridge unit tests
       bridgeTransferFrom()
         fails if `toTokenAddress.transfer()` returns false:
     TypeError: Expected the revert reason to be a string or a regular expression
      at Proxy.<anonymous> (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-chai-matchers/src/internal/reverted/revertedWith.ts:26:15)
      at Proxy.methodWrapper (/Users/king/javascript/protocol/node_modules/chai/lib/chai/utils/addMethod.js:57:25)
      at doAsserterAsyncAndAddThen (/Users/king/javascript/protocol/node_modules/chai-as-promised/lib/chai-as-promised.js:289:22)
      at Proxy.<anonymous> (/Users/king/javascript/protocol/node_modules/chai-as-promised/lib/chai-as-promised.js:255:20)
      at Proxy.overwritingMethodWrapper (/Users/king/javascript/protocol/node_modules/chai/lib/chai/utils/overwriteMethod.js:78:33)
      at Context.<anonymous> (test/eth2dai_bridge.ts:216:37)

  17) KyberBridge unit tests
       bridgeTransferFrom()
         "before all" hook for "returns magic bytes on success":
     TypeError: testContract.weth is not a function
      at Context.<anonymous> (test/kyber_bridge.ts:52:46)
      at processImmediate (node:internal/timers:505:21)

  18) StaticCallProxy
       transferFrom
         should be successful if a function call returns a complex type:
     Error: VM Exception while processing transaction: reverted with reason string 'UNEXPECTED_STATIC_CALL_RESULT'
    at StaticCallProxy.transferFrom (contracts/src/StaticCallProxy.sol:68)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.transferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async Context.<anonymous> (test/static_call_proxy.ts:217:24)
  

  19) UniswapBridge unit tests
       bridgeTransferFrom()
         just transfers tokens to `to` if the same tokens are in play:
     Error: No TokenTransfer events found
      at verifyTokenTransfer (test/utils/bridge_event_helpers.ts:98:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:192:32)

  20) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> token
           calls `IUniswapExchange.tokenToTokenTransferInput():
     Error: No TokenToTokenTransferInput events found
      at verifyTokenToTokenTransferInput (test/utils/bridge_event_helpers.ts:158:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:206:48)

  21) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> token
           sets allowance for "from" token:
     Error: No TokenApprove events found
      at verifyTokenApprove (test/utils/bridge_event_helpers.ts:132:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:222:35)

  22) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> token
           sets allowance for "from" token on subsequent calls:
     Error: No TokenApprove events found
      at verifyTokenApprove (test/utils/bridge_event_helpers.ts:132:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:234:35)

  23) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> ETH
           calls `IUniswapExchange.tokenToEthSwapInput()`, `WETH.deposit()`, then `transfer()`:
     Error: No TokenToEthSwapInput events found
      at verifyEvent (test/utils/bridge_event_helpers.ts:194:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:268:28)

  24) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> ETH
           sets allowance for "from" token:
     Error: No TokenApprove events found
      at verifyTokenApprove (test/utils/bridge_event_helpers.ts:132:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:296:35)

  25) UniswapBridge unit tests
       bridgeTransferFrom()
         token -> ETH
           sets allowance for "from" token on subsequent calls:
     Error: No TokenApprove events found
      at verifyTokenApprove (test/utils/bridge_event_helpers.ts:132:15)
      at Context.<anonymous> (test/uniswap_bridge.ts:310:35)

  26) UniswapBridge unit tests
       bridgeTransferFrom()
         ETH -> token
           calls  `WETH.withdraw()`, then `IUniswapExchange.ethToTokenTransferInput()`:
     Error: Transaction reverted: function call failed to execute
    at TestToken.withdraw (contracts/test/TestUniswapBridge.sol:222)
    at TestUniswapBridge.bridgeTransferFrom (contracts/src/bridges/UniswapBridge.sol:98)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.bridgeTransferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async withdrawToAsync (test/uniswap_bridge.ts:147:42)
    at async Context.<anonymous> (test/uniswap_bridge.ts:348:51)
  

  27) UniswapBridge unit tests
       bridgeTransferFrom()
         ETH -> token
           does not set any allowance:
     Error: Transaction reverted: function call failed to execute
    at TestToken.withdraw (contracts/test/TestUniswapBridge.sol:222)
    at TestUniswapBridge.bridgeTransferFrom (contracts/src/bridges/UniswapBridge.sol:98)
    at EdrProviderWrapper.request (/Users/king/javascript/protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at async HardhatEthersSigner.sendTransaction (/Users/king/javascript/protocol/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at async send (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at async Proxy.bridgeTransferFrom (/Users/king/javascript/protocol/node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at async withdrawToAsync (test/uniswap_bridge.ts:147:42)
    at async Context.<anonymous> (test/uniswap_bridge.ts:368:34)
  

  28) UniswapBridge unit tests
       bridgeTransferFrom()
         ETH -> token
           fails if the exchange fails:

      AssertionError: expected promise to be rejected with an error including 'FOOBAR' but got 'Transaction reverted: function call fâ€¦'
      + expected - actual

      -Transaction reverted: function call failed to execute
      +FOOBAR
      
  

  29) UniswapV2 unit tests
       bridgeTransferFrom()
         performs transfer when both tokens are the same:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/uniswapv2_bridge.ts:182:41)

  30) UniswapV2 unit tests
       bridgeTransferFrom()
         token -> token
           calls UniswapV2Router01.swapExactTokensForTokens():

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/uniswapv2_bridge.ts:198:45)

  31) UniswapV2 unit tests
       bridgeTransferFrom()
         token -> token
           sets allowance for "from" token:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/uniswapv2_bridge.ts:213:45)

  32) UniswapV2 unit tests
       bridgeTransferFrom()
         token -> token
           sets allowance for "from" token on subsequent calls:

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/uniswapv2_bridge.ts:223:45)

  33) UniswapV2 unit tests
       bridgeTransferFrom()
         token -> token -> token
           calls UniswapV2Router01.swapExactTokensForTokens():

      AssertionError: expected +0 to equal 1
      + expected - actual

      -0
      +1
      
      at Context.<anonymous> (test/uniswapv2_bridge.ts:247:45)



error Command failed with exit code 33.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
ERROR: "test:hardhat" exited with 33.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
